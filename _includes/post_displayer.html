{% assign required_tags = include.tags | split: "," %}
{% assign matching_posts = "" | split: "" %}

{% for post in site.posts %}
{% assign match = true %}
{% for required_tag in required_tags %}
  {% unless post.tags contains required_tag %}
    {% assign match = false %}
    {% break %}
  {% endunless %}
{% endfor %}

{% if match %}
  {% assign matching_posts = matching_posts | push: post %}
{% endif %}
{% endfor %}

{% if matching_posts.size > 0 %}
<h2>{{ include.title | default: "related posts" }}</h2>
{% for post in matching_posts %}
  <article>
    <h3>
      <a href="{{ post.url }}">
        {{ post.title }}
      </a>
    </h3>
    <time datetime="{{ post.date | date: "%Y-%m-%d" }}"><small>{{ post.date | date_to_long_string }}</small></time>
    <p><small>{{ post.excerpt }}</small></p>
  </article>
{% endfor %}
{% endif %}